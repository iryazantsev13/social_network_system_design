# System design социальной сети

## Функциональные требования

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;
- кроссплатформенность (мобильное приложение и web интерфейс)

## Нефункциональные требования:
### аудитория
- страны СНГ
- рост кол-ва пользователей до 10 000 000 (DAU) через год после запуска, далее также планируется рост, но пока без конкретного прогноза (предположим по 2 млн пользователей во второй и последующие годы)
### сезонность: 
- выраженный сезон отпусков (x3, до x5 нагрузка в июле)
### активность пользователей:
- каждый 10-й пользователь создает 1 пост в день
- 1 пользователь в среднем 
    - листает ленту 10 раз в день
    - выставляет до 3х реакций в день
    - комментирует посты 1 раз в 5 дней
    - просматривает комментарии под постами 1 раз в дней
    - ищет и просматривает популярные места 1 раз в 20 дней
    - подписывается на другого пользователя 1 раз в 30 дней
- каждый пользователь в среднем имеет 50 подписчиков
### информация о постах:
- пост состоит из заголовка, от 1 до 3х фотографий, геоданных (не обязательно) и текста
- 1 фотография до 500 Kb
- заголовок и описание до 100 (400 байт) и 500 символов (2000 байт) соответственно
- в среднем пост состоит из 50 символов заголовка 1 фотографии и 300 символов описания
- комментарий ограничен 100 символами (в среднем 50)
### Доступность: 
- 99,999%

### Прочее
- Храним данные за все время

## Нагрузка
средняя:
- создание постов: 10000000 / 10 / 86400 = _**11,57 rps (read)**_
- выдача ленты постов: 10000000 * 10 / 86400 = _**1157 rps (write)**_
- комментирование постов: 10000000 / 5 / 86400 = _**23,14 rps (write)**_
- просмотр комментариев под постами: 10000000 / 86400 = _**115,7 rps (read)**_
- поиск мест: 10000000 / 20 / 86400 = _**5,78 (read)**_
- подписаться на человека: 10000000 / 30 / 86400 = _**3,8 (write)**_

максимальная (критичные узлы): 
- создание постов: 11,57 * 5 = _**57,85 rps (read)**_
- выдача ленты постов: 1157 * 5 = _**5785 rps (read)**_

## Model
### Посты:

    POST /api/users/{id}/posts (новый пост)
    GET /api/users/{id}/posts/feed?size=10&page=0 (лента)
    GET /api/places/popular?size=10&page=0 (выдача полпулярных мест)
    GET /api/places/{id}/posts?size=10&page=0 (просмотр постов о конеретном месте)

    {
        post_id
        place_id
        title
        []images
        text
        []emojies{emoji, []users}
    }

### Комменты:

    POST /api/users/{id}/posts/{id}/comments
    GET /api/users/{id}/posts/{id}/comments?size=10&page=1

    {
        comment_id
        comment
        []emojies{emoji, []users}
    }

### Реакции:

    /users/{user_id}/posts/{post_id}/emoji
    /users/{user_id}/posts/{post_id}/comments/{comment_id}/emoji

    {
        id
    }

### Подписки:
    
    POST /api/users/{id}/subscribe

    {user_id}

## Traffic

Фотографии: 
>Трафик на запись
- 11,57 * 500KB (/1024) = 5,5 MB/s
- 5,5 * 86400 * 365 (/1024/1024) = 165 TB в год
>Трафик на чтение
- 1157 * 500KB * 10 (/1024/1024) = 5,51 ГB/s

Пост без фотографии:
>Трафик на запись
- Допущение: история с реакциями и их принадлежности пользователям будем считать в среднем 200 байт
- 11,57 * (8+8+200+1200+200) (/1024) = 18,2 KB/s
- 18,2 * 86400 * 365 (/1024/1024) = 547 GB в год
>Трафик на чтение
- 1157 * (8+8+200+1200+200+32) * 10 (/1024/1024) = 18,2 MB/s

Комменты:
- Допущение: история с реакциями и их принадлежности пользователям будем считать в среднем 50 байт для комментариев
- 23,47 * 458 = 10,4 KB/s
- 10,4 * 86400 * 365 (/1024/1024) = 312GB



